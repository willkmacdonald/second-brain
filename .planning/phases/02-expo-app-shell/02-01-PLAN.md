---
phase: 02-expo-app-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mobile/package.json
  - mobile/app.json
  - mobile/tsconfig.json
  - mobile/.env.example
  - mobile/app/_layout.tsx
  - mobile/app/index.tsx
  - mobile/components/CaptureButton.tsx
autonomous: true
requirements: [APPX-01, CAPT-05]

must_haves:
  truths:
    - "User can open the app and see four large capture buttons (Voice, Text, Photo, Video) in a vertical stack"
    - "No settings, folders, tags, header, or branding visible on the main screen"
    - "Voice, Photo, and Video buttons are visually dimmed and show a 'Coming soon' toast when tapped"
    - "Text button is visually active (not dimmed)"
    - "App runs on both iOS and Android via Expo"
  artifacts:
    - path: "mobile/app/index.tsx"
      provides: "Main capture screen with four buttons"
      min_lines: 30
    - path: "mobile/components/CaptureButton.tsx"
      provides: "Reusable capture button with icon, label, disabled state, haptic feedback"
      min_lines: 40
    - path: "mobile/app/_layout.tsx"
      provides: "Root layout with Stack navigator, headerShown false"
      min_lines: 10
    - path: "mobile/package.json"
      provides: "Expo SDK 54 project with all dependencies"
  key_links:
    - from: "mobile/app/index.tsx"
      to: "mobile/components/CaptureButton.tsx"
      via: "import { CaptureButton }"
      pattern: "import.*CaptureButton.*from"
    - from: "mobile/app/index.tsx"
      to: "expo-router"
      via: "router.push for Text button"
      pattern: "router\\.push.*capture/text"
---

<objective>
Create the Expo mobile app project and build the main capture screen with four large buttons.

Purpose: Establish the mobile app foundation and deliver the primary UI surface -- four full-width capture buttons in a vertical stack with dark mode styling. Voice, Photo, and Video buttons are disabled with "Coming soon" toast; Text button navigates to the capture screen (built in Plan 02-02).

Output: A runnable Expo app with the main capture screen visible on both iOS and Android.
</objective>

<execution_context>
@/Users/willmacdonald/.claude/get-shit-done/workflows/execute-plan.md
@/Users/willmacdonald/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-expo-app-shell/02-CONTEXT.md
@.planning/phases/02-expo-app-shell/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Expo project scaffold with dependencies and configuration</name>
  <files>
    mobile/package.json
    mobile/app.json
    mobile/tsconfig.json
    mobile/.env.example
    mobile/.gitignore
  </files>
  <action>
    Create the Expo project in a `mobile/` directory at the repo root (parallel to `backend/`).

    **Step 1: Create the project**
    ```bash
    npx create-expo-app@latest mobile --template blank-typescript
    ```
    Use `blank-typescript` template (NOT `default` -- default includes tab navigation boilerplate we don't want).

    **Step 2: Install dependencies**
    ```bash
    cd mobile
    npx expo install expo-secure-store expo-haptics
    npm install react-native-sse @ag-ui/core
    ```

    **Step 3: Install expo-router**
    Expo Router requires specific setup. Follow the expo-router installation:
    ```bash
    npx expo install expo-router react-native-safe-area-context react-native-screens expo-linking expo-constants expo-status-bar
    ```

    **Step 4: Configure app.json for expo-router**
    Update `app.json` to include the expo-router scheme and entry point:
    ```json
    {
      "expo": {
        "name": "Second Brain",
        "slug": "second-brain",
        "scheme": "second-brain",
        "version": "1.0.0",
        "orientation": "portrait",
        "userInterfaceStyle": "dark",
        "platforms": ["ios", "android"],
        "plugins": ["expo-router", "expo-secure-store"],
        "web": {
          "bundler": "metro"
        }
      }
    }
    ```

    **Step 5: Update package.json main entry**
    Set the `"main"` field in package.json to `"expo-router/entry"` (required by expo-router).

    **Step 6: Create .env.example**
    ```
    # Backend API URL (deployed Azure Container Apps)
    EXPO_PUBLIC_API_URL=https://your-app.azurecontainerapps.io
    # API key for backend authentication
    EXPO_PUBLIC_API_KEY=your-api-key-here
    ```

    **Step 7: Add .gitignore entries**
    Ensure mobile/.gitignore includes: node_modules/, .expo/, dist/, *.jks, *.p8, *.p12, *.key, *.mobileprovision, *.orig.*, web-build/, .env

    **Step 8: Verify project structure**
    Run `npx expo doctor` to validate the configuration.

    Note: The `app/` directory for routes will be created in Task 2. If `create-expo-app` creates a default `App.tsx`, delete it -- expo-router uses `app/_layout.tsx` as entry.
  </action>
  <verify>
    - `ls mobile/package.json` exists
    - `cat mobile/package.json | grep expo-router` shows expo-router dependency
    - `cat mobile/package.json | grep react-native-sse` shows react-native-sse dependency
    - `cat mobile/package.json | grep expo-secure-store` shows expo-secure-store dependency
    - `cat mobile/package.json | grep expo-haptics` shows expo-haptics dependency
    - `cat mobile/.env.example` shows EXPO_PUBLIC_API_URL and EXPO_PUBLIC_API_KEY
    - `cd mobile && npx tsc --noEmit` compiles without errors (after Task 2 creates files)
  </verify>
  <done>
    Expo SDK 54 project exists in mobile/ with expo-router, react-native-sse, expo-secure-store, expo-haptics, and @ag-ui/core installed. App.json configured for dark mode, portrait orientation, and expo-router plugin.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build main capture screen with CaptureButton component</name>
  <files>
    mobile/app/_layout.tsx
    mobile/app/index.tsx
    mobile/components/CaptureButton.tsx
  </files>
  <action>
    **File 1: mobile/components/CaptureButton.tsx**

    Create a reusable `CaptureButton` component using `Pressable` (NOT TouchableOpacity -- semi-deprecated per research).

    Props interface:
    ```typescript
    interface CaptureButtonProps {
      label: string;
      icon: string; // emoji character
      onPress: () => void;
      disabled?: boolean;
    }
    ```

    Behavior:
    - On press: trigger `Haptics.impactAsync(ImpactFeedbackStyle.Medium)` then call `onPress`
    - Pressed state: `opacity: 0.7`, `transform: [{ scale: 0.96 }]` (via Pressable style callback)
    - Disabled state: `opacity: 0.4` (per locked decision: "visually dimmed/faded/grayed")
    - Styling: Dark background (`#1a1a2e`), white text, rounded corners (`borderRadius: 16`), full-width
    - Layout: Each button should be a tall rectangle taking equal vertical space (use `flex: 1` with vertical arrangement, NOT grid/wrap)
    - Icon: large emoji (fontSize ~48), label below (fontSize ~20, fontWeight 600, white)
    - Margin between buttons: 8-12px vertical

    **File 2: mobile/app/_layout.tsx**

    Root layout with Stack navigator:
    ```typescript
    import { Stack } from "expo-router";

    export default function RootLayout() {
      return (
        <Stack screenOptions={{ headerShown: false }}>
          <Stack.Screen name="index" />
          <Stack.Screen
            name="capture/text"
            options={{
              headerShown: true,
              headerTitle: "",
              headerStyle: { backgroundColor: "#0f0f23" },
              headerTintColor: "#ffffff",
              presentation: "modal",
            }}
          />
        </Stack>
      );
    }
    ```

    The text capture screen header shows a Back button (via headerTintColor white on dark background). headerTitle is empty (no text label per context decision "no header, no branding"). The presentation "modal" gives a slide-up animation on iOS.

    **File 3: mobile/app/index.tsx**

    Main capture screen with four buttons in a VERTICAL STACK (per locked decision: "Vertical stack of four full-width buttons").

    Button order per locked decision: Voice, Text, Photo, Video.

    Icon choices (Claude's discretion):
    - Voice: microphone emoji or similar
    - Text: keyboard/writing emoji
    - Photo: camera emoji
    - Video: video camera emoji

    Use `SafeAreaView` as root container with `backgroundColor: "#0f0f23"` (dark theme per locked decision).

    Layout: Use a `View` with `flex: 1`, arrange buttons vertically with equal spacing. Each button fills available width with padding. The four buttons should fill the screen vertically with even distribution.

    Button handlers:
    - Voice: show toast "Coming soon" (per locked decision: same generic message for all three)
    - Text: `router.push("/capture/text")` (navigates to text capture screen)
    - Photo: show toast "Coming soon"
    - Video: show toast "Coming soon"

    Toast implementation (Claude's discretion): Use a simple approach -- `ToastAndroid` on Android + a custom lightweight toast for iOS (or use `Alert.alert` as temporary MVP). Alternatively, use React Native's built-in `Alert.alert("Coming soon")` which works cross-platform. Keep it simple -- no toast library needed for "Coming soon".

    Pass `disabled={true}` to Voice, Photo, Video buttons. Text button: `disabled` omitted (active).

    Delete any `App.tsx` file if it exists from create-expo-app (expo-router uses app/_layout.tsx instead).
  </action>
  <verify>
    - `ls mobile/app/_layout.tsx mobile/app/index.tsx mobile/components/CaptureButton.tsx` -- all three files exist
    - `cd mobile && npx tsc --noEmit` -- TypeScript compiles cleanly
    - `cd mobile && npx expo start` -- app launches in Expo Go (manual check: four buttons visible, dark background, Voice/Photo/Video dimmed, Text active)
  </verify>
  <done>
    Main capture screen shows four full-width buttons in a vertical stack (Voice, Text, Photo, Video) on a dark background. Voice, Photo, Video are visually dimmed and show "Coming soon" on tap. Text button is active and navigates to /capture/text route. No header, branding, settings, or folders visible. CaptureButton component provides haptic feedback on press.
  </done>
</task>

</tasks>

<verification>
1. Run `cd mobile && npx tsc --noEmit` -- no TypeScript errors
2. Run `cd mobile && npx expo start` -- app starts without crashes
3. Visual check: four buttons visible in vertical stack on dark background
4. Tap Voice/Photo/Video -- "Coming soon" message appears
5. Tap Text -- navigates to empty text capture route (screen built in Plan 02-02)
6. Buttons have haptic feedback on press
</verification>

<success_criteria>
- Expo project exists in mobile/ with all dependencies installed
- Main screen shows exactly four buttons: Voice, Text, Photo, Video (in that order)
- Dark mode styling throughout (dark background, light text)
- No visible settings, folders, tags, headers, or branding
- Disabled buttons are visually dimmed and show "Coming soon" toast
- Text button navigates to /capture/text
- App launches without errors on iOS and Android via Expo
</success_criteria>

<output>
After completion, create `.planning/phases/02-expo-app-shell/02-01-SUMMARY.md`
</output>
