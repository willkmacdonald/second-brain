# Phase 04.1: Backend Deployment to Azure Container Apps - Context

**Gathered:** 2026-02-23
**Status:** Ready for planning

<domain>
## Phase Boundary

Deploy the existing FastAPI backend (AG-UI server, Cosmos DB integration, classification pipeline) to Azure Container Apps so it's accessible from Will's phone for real UAT. This phase covers containerization, deployment infrastructure, secrets management, and CI/CD — not any backend feature changes.

</domain>

<decisions>
## Implementation Decisions

### Access and networking
- Public endpoint, secured by existing API key auth middleware (built in Phase 1)
- Custom domain with managed TLS certificate (user will provide domain when ready)
- HTTPS enforced — redirect all HTTP to HTTPS
- Azure Container Apps free managed cert for TLS

### Configuration and secrets
- Secrets (Cosmos connection string, OpenAI key, API key) pulled from Azure Key Vault
- Key Vault already provisioned — configure access from Container App
- System-assigned managed identity on Container App for Key Vault authentication
- Non-secret config (COSMOS_DATABASE_NAME, API version, etc.) as plain environment variables on the Container App
- Existing Key Vault fetch in lifespan code should work with managed identity's DefaultAzureCredential

### Container build and registry
- Azure Container Registry (ACR) — already provisioned
- Managed identity pull from Container Apps to ACR
- Dockerfile uses uv for dependency management (multi-stage build, matches local dev tooling)
- Images tagged with short git commit SHA (immutable, traceable to source)

### CI/CD and deployment flow
- GitHub Actions pipeline for automated deployment
- Trigger: push to main branch with path filter (backend/ changes only)
- OIDC (Workload Identity Federation) for GitHub Actions → Azure authentication (no stored secrets)
- Requires one-time setup: Azure app registration + federated credential for the GitHub repo

### Claude's Discretion
- Container App scaling configuration (min/max replicas)
- Health check endpoint configuration
- Resource allocation (CPU/memory)
- Multi-stage Dockerfile optimization details
- GitHub Actions workflow structure and job naming

</decisions>

<specifics>
## Specific Ideas

- Existing Key Vault fetch pattern in backend lifespan should carry over — DefaultAzureCredential works with managed identity
- Backend already runs on port 8003 locally; container should expose the same or standard 8000/80
- The codebase already has `.env.example` documenting required env vars — use this as reference for Container App config

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 04.1-backend-deployment-to-azure-container-apps*
*Context gathered: 2026-02-23*
